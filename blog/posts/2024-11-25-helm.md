---
title_pl: Prosty cluster k8s z helm chart
title_en: Simple k8s cluster with chelm chart
date: 2025-11-17
description_pl: O tym jak dodaÅ‚em Helm charts do prostego clustra k8s z poprzedniego wpisu.
description_en: How I've added Helm charts to the simple k8s cluster from last post.
---

## PL

## 1. WstÄ™p

W tym wpisie rozbudowujemy poprzedni przykÅ‚ad prostego clustra Kubernetes, 
dodajÄ…c do niego Helm charts. Najpierw wprowadzam kilka zmian w Å›rodowisku, 
potem przechodzÄ™ do minimalnego przykÅ‚adu pracy z Helmem, pokazujÄ…c, 
jak wyglÄ…da podstawowa struktura chartu i jak wykonaÄ‡ pierwsze wdroÅ¼enie.
CaÅ‚oÅ›Ä‡ ma na celu zademonstrowanie, Å¼e Helm moÅ¼e byÄ‡ uÅ¼ywany w sposÃ³b 
bardzo prosty, a jednoczeÅ›nie zapewnia solidne fundamenty pod bardziej 
zÅ‚oÅ¼one scenariusze.

## 2. Czym sÄ… Helm Charts


## 3. Implementacja

### 3.1 Pare zmian zanim zaczniemy

Na wstÄ™pie parÄ™ zmian w porÃ³wnaniu do ostatniego wpisu.
Po pierwsze nasze proste api staÅ‚o siÄ™ mniej proste, 
wyÅ›wietla pare dodatkowych informacji:

```
mpio@Marcins-MacBook-Air ~ % curl localhost:8080 | jq  
{
  "hostname": "Marcins-MacBook-Air.local",
  "namespace": null,
  "node_name": null,
  "pod_ip": null,
  "status": "ok"
}
```

Ponadto przerzuciÅ‚em siÄ™ z clustra zapewnianego przez Rancher na Kind.
DziaÅ‚a to nastÄ™pujÄ…co:

```
mpio@Marcins-MacBook-Air ~ % kind create cluster 
Creating cluster "kind" ...
 âœ“ Ensuring node image (kindest/node:v1.34.0) ğŸ–¼ 
 âœ“ Preparing nodes ğŸ“¦  
 âœ“ Writing configuration ğŸ“œ 
 âœ“ Starting control-plane ğŸ•¹ï¸ 
 âœ“ Installing CNI ğŸ”Œ 
 âœ“ Installing StorageClass ğŸ’¾ 
Set kubectl context to "kind-kind"
You can now use your cluster with:
kubectl cluster-info --context kind-kind
To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
mpio@Marcins-MacBook-Air ~ % kubectl config get-contexts
CURRENT   NAME        CLUSTER     AUTHINFO    NAMESPACE
*         kind-kind   kind-kind   kind-kind   
```

Z racji Å¼e uÅ¼ywamy Kind konieczna byÅ‚a rÃ³wnieÅ¼ zmiana typu service z 
LoadBalancer na NodePort. W Rancher Desktop typ LoadBalancer dziaÅ‚a, 
poniewaÅ¼ Rancher dostarcza lokalnÄ… implementacjÄ™ load balancera i 
potrafi przydzieliÄ‡ zewnÄ™trzny adres IP. Kind takiego mechanizmu 
nie posiada â€“ to czysty cluster uruchamiany w kontenerach Dockera,
bez komponentu odpowiadajÄ…cego za realizacjÄ™ usÅ‚ug LoadBalancer. 
Dlatego service tego typu nigdy nie dostanie adresu IP i 
pozostaje w stanie â€pendingâ€.

Najprostsze rozwiÄ…zanie to uÅ¼ycie `kubectl port-forward`, 
ktÃ³re tworzy tunel z lokalnego portu do portu service 
w klastrze. kubectl zestawia poÅ‚Ä…czenie z API serverem i 
przekazuje caÅ‚y ruch z twojej maszyny do wskazanego service:

```
mpio@Marcins-MacBook-Air ~ % kubectl port-forward service/demo-api 8080:8080
Forwarding from 127.0.0.1:8080 -> 8080
Forwarding from [::1]:8080 -> 8080
```
```
mpio@Marcins-MacBook-Air ~ % curl localhost:8080 | jq
{
  "hostname": "demo-api-7df9444d9c-f2w47",
  "namespace": "default",
  "node_name": "kind-control-plane",
  "pod_ip": "10.244.0.5",
  "status": "ok"
}
```

Tym razem widaÄ‡ jak na dÅ‚oni, Å¼e nasza aplikacja dziaÅ‚a wewnÄ…trz clustra.

### 3.2 Minimalny przykÅ‚ad

Jedziemy z Helmem. Najpierw trzeba go oczywiÅ›cie zainstalowaÄ‡ ale to juÅ¼ pominÄ™.
Aby zaczÄ…Ä‡ moÅ¼na wykorzystaÄ‡ nastÄ™pujÄ…cÄ… komendÄ™:
```
mpio@Marcins-MacBook-Air ~ % helm create simple-chart
Creating simple-chart
```
Helm wygenerowaÅ‚ peÅ‚ny â€starter chartâ€ â€“ kompletny zestaw plikÃ³w i katalogÃ³w,
ktÃ³ry ma pokazaÄ‡, jak zbudowany jest typowy chart.
Wygenerowana zostaÅ‚a caÅ‚a struktura: 
`Chart.yaml`, `values.yaml` z duÅ¼Ä… liczbÄ… przykÅ‚adowych parametrÃ³w,
a w katalogu `templates/` wiele zasobÃ³w takich jak Deployment, Service, 
Ingress, HPA, ServiceAccount.

To wszystko jest przydatne przy bardziej rozbudowanych projektach, 
ale w naszym przypadku stanowi wyÅ‚Ä…cznie szum. 
Chcemy mieÄ‡ moÅ¼liwie prosty chart pokazujÄ…cy wyÅ‚Ä…cznie Deployment i Service.
Dlatego caÅ‚oÅ›Ä‡ porzÄ…dkujemy i zostawiamy tylko minimalny zestaw plikÃ³w:

```
simple-chart/
â”œâ”€â”€ Chart.yaml
â”œâ”€â”€ values.yaml
â””â”€â”€ templates/
    â”œâ”€â”€ deployment.yaml
    â””â”€â”€ service.yaml
```
Plik `Chart.yaml` zawiera podstawowe informacje takie jak nazwa czy wersja.
Plik `values.yaml` z kolei moÅ¼e zawieraÄ‡ faktycznie wartoÅ›ci konfiguracyjne
naszego Clustra, lecz nie musi. Na ten moment pozostanie pusty, aby
zademonstrowaÄ‡, Å¼e tak naprawdÄ™ nie jest potrzebny. Pliki `deployment.yaml` oraz `service.yaml` pozostajÄ… bez zmian.

Mamy wszystko, co potrzebne, aby zrobiÄ‡ pierwsze wdroÅ¼enie k8s z Helm charts.
W tym celu wykorzystamy komendÄ™ `helm install`
```
mpio@Marcins-MacBook-Air DemoApi %  helm install my-release-name ./demo-chart
NAME: my-release-name
LAST DEPLOYED: Tue Nov 25 21:01:00 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
DESCRIPTION: Install complete
TEST SUITE: None
```

To tyle w tym minimalnym przykÅ‚adzie. Pokazuje on sedno dziaÅ‚ania Helma: 
jest to jedynie warstwa nad Kubernetesem, ktÃ³ra generuje i zarzÄ…dza 
manifestami w bardziej uporzÄ…dkowany sposÃ³b. Sam mechanizm jest prosty,
ale daje ogromne moÅ¼liwoÅ›ci â€“ od templatingu, przez wersjonowanie releasÃ³w,
po Å‚atwÄ… aktualizacjÄ™ i rollback.
W kolejnym wpisie przygotujemy coÅ› bardziej rozbudowanego, aby
lepiej wykorzystaÄ‡ potencjaÅ‚ Helm charts.


## EN